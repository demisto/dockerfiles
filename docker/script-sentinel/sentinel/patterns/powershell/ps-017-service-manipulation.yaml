# PowerShell Pattern: Service Creation and Modification
# Detects Windows service manipulation

id: PS-017
name: Service Creation and Modification
description: |
  Detects creation, modification, or manipulation of Windows services using
  PowerShell. Attackers use service manipulation for persistence, privilege
  escalation, and defense evasion. This pattern identifies New-Service,
  Set-Service, sc.exe commands, and WMI service operations.
languages:
  - powershell
detection_type: regex
detection_logic: '(?i)(?:New-Service|Set-Service|sc\.exe.*create|sc\.exe.*config|Get-WmiObject.*Win32_Service.*Create)'
severity: Medium
mitre_technique: T1543.003
confidence: 0.8
category: persistence
enabled: true
metadata:
  author: Script Sentinel Team
  created: "2025-11-17"
  updated: "2025-11-17"
  references:
    - "https://attack.mitre.org/techniques/T1543/003/"
    - "https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-service"
  tags:
    - powershell
    - service
    - persistence
    - privilege-escalation
  examples:
    - "New-Service -Name 'Updater' -BinaryPathName 'C:\\malware.exe' -StartupType Automatic"
    - "sc.exe create EvilService binPath= C:\\backdoor.exe start= auto"
    - "Set-Service -Name 'TrustedInstaller' -StartupType Disabled"
    - "$service = Get-WmiObject Win32_Service -Filter \"Name='MyService'\"; $service.Change($null, 'C:\\evil.exe')"