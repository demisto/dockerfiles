# PowerShell Pattern: Ampersand Operator Execution
# Detects indirect code execution using the call operator (&)

id: PS-033
name: Ampersand Operator Execution
description: |
  Detects use of the PowerShell call operator (&) for indirect command execution.
  The ampersand operator executes commands stored in variables or expressions,
  commonly used by attackers to evade detection by avoiding direct use of
  Invoke-Expression. This pattern identifies suspicious use of & with variables,
  expressions, or obfuscated strings.
languages:
  - powershell
detection_type: regex
detection_logic: '(?i)&\s*(?:\$\w+|\([^)]+\)|["\x27]\w+["\x27])\s*(?:-enc|-command|\.ps1|\.exe|\.bat|\.cmd|http)'
severity: High
mitre_technique: T1059.001
confidence: 0.85
category: execution
enabled: true
metadata:
  author: Script Sentinel Team
  created: "2025-11-25"
  updated: "2025-11-25"
  references:
    - "https://attack.mitre.org/techniques/T1059/001/"
    - "https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_operators"
  tags:
    - powershell
    - execution
    - indirect-execution
    - call-operator
  examples:
    - "& $command"
    - "& ('I'+'EX') $payload"
    - "& (Get-Command Invoke-Expression)"
    - "& $env:comspec /c calc.exe"