# PowerShell Pattern: Script Block Logging Disable
# Detects attempts to disable PowerShell logging

id: PS-011
name: PowerShell Logging Evasion
description: |
  Detects attempts to disable or bypass PowerShell script block logging and
  transcription. Attackers disable logging to evade detection and prevent
  forensic analysis. This pattern identifies modifications to logging settings
  via Group Policy, registry, or runtime configuration changes.
languages:
  - powershell
detection_type: regex
detection_logic: '(?i)(?:Set-ItemProperty.*ScriptBlockLogging.*EnableScriptBlockLogging.*0|GPO.*ScriptBlockLogging|LogPipelineExecutionDetails.*False|EnableTranscripting.*0)'
severity: High
mitre_technique: T1562.002
confidence: 0.9
category: defense_evasion
enabled: true
metadata:
  author: Script Sentinel Team
  created: "2025-11-17"
  updated: "2025-11-17"
  references:
    - "https://attack.mitre.org/techniques/T1562/002/"
    - "https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_logging"
  tags:
    - powershell
    - logging
    - defense-evasion
    - anti-forensics
  examples:
    - "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging' -Name 'EnableScriptBlockLogging' -Value 0"
    - "$GPO = [Microsoft.Win32.Registry]::LocalMachine.OpenSubKey('SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\Transcription', $true)"
    - "Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Wow6432Node\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging' -Name 'EnableScriptBlockInvocationLogging' -Value 0"