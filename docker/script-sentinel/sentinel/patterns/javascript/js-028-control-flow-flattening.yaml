# JavaScript Pattern: Control Flow Flattening
# Detects control flow flattening obfuscation technique

id: JS-028
name: Control Flow Flattening
description: |
  Detects control flow flattening, an obfuscation technique that transforms
  normal control flow into a state machine using switch statements inside loops.
  This makes the code execution path harder to follow during static analysis.
  Attackers use this to hide malicious logic and evade detection.
languages:
  - javascript
detection_type: regex
detection_logic: 'while\s*\(\s*true\s*\)\s*\{[\s\S]*switch\s*\(\s*[a-zA-Z_][a-zA-Z0-9_]*\s*\)|while\s*\(\s*[0-9]+\s*\)\s*\{[\s\S]*switch\s*\(|for\s*\(\s*;\s*;\s*\)\s*\{[\s\S]*switch\s*\('
severity: High
mitre_technique: T1027
confidence: 0.85
category: obfuscation
enabled: true
metadata:
  author: Script Sentinel Team
  created: "2025-11-19"
  updated: "2025-11-19"
  references:
    - "https://attack.mitre.org/techniques/T1027/"
    - "https://obfuscator.io/"
  tags:
    - javascript
    - obfuscation
    - control-flow-flattening
    - state-machine
  examples:
    - "while (true) { switch(state) { case 0: ...; break; } }"
    - "while (1) { switch(s) { case 1: malicious(); break; } }"
    - "for (;;) { switch(x) { case 0: return; } }"